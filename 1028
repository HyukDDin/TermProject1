# --- [Auth Block] SQLite + Passlib í•´ì‹œ + Streamlit ì¸ì¦ UI -------------------
# ì´ ëª¨ë“ˆì€ "ë¡œê·¸ì¸/íšŒì›ê°€ì…"ê³¼ "ê°œì¸í™”/ê´€ë¦¬ì"ì— í•„ìš”í•œ
# 1) SQLite ìŠ¤í‚¤ë§ˆ/CRUD
# 2) ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ/ê²€ì¦(passlib.bcrypt)
# 3) Streamlit ë¡œê·¸ì¸/íšŒì›ê°€ì… UI
# ë¥¼ í•œ ë²ˆì— ì œê³µí•œë‹¤.

import sqlite3
import time
import re
from datetime import datetime
from typing import Optional, Dict, Any

import streamlit as st
from passlib.hash import bcrypt  # ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•ˆì „í•˜ê²Œ í•´ì‹œ/ê²€ì¦í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

DB_PATH = "users.db"  # ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì»¬ DB íŒŒì¼ ê²½ë¡œ


# ---------------------------------------------------------------------
# 0) DB ì—°ê²° ë„ìš°ë¯¸
# ---------------------------------------------------------------------
def _conn() -> sqlite3.Connection:
    """
    [ì—­í• ] SQLite ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ëŠ” í—¬í¼.
    - check_same_thread=False : Streamlit ì½œë°±/ìœ„ì ¯ì´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì²˜ëŸ¼ ë¶ˆë¦¬ëŠ” ìƒí™©ì—ì„œ
      ê°™ì€ ì»¤ë„¥ì…˜ì„ ì•ˆì „íˆ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì˜µì…˜.
    """
    return sqlite3.connect(DB_PATH, check_same_thread=False)


# ---------------------------------------------------------------------
# 1) DB ìŠ¤í‚¤ë§ˆ ì´ˆê¸°í™”  (users / user_ratings / user_favorites + ê¸°ë³¸ admin)
# ---------------------------------------------------------------------
def init_db() -> None:
    """
    [ì—­í• ] ì•± ìµœì´ˆ ì‹¤í–‰ ì‹œ í…Œì´ë¸”ì´ ì—†ìœ¼ë©´ ìƒì„±í•˜ê³ ,
          ê¸°ë³¸ admin ê³„ì •(ì•„ì´ë””: admin, ë¹„ë²ˆ: admin123)ì„ ë³´ì¥í•œë‹¤.
    - ìš´ì˜ ë°°í¬ ì‹œì—ëŠ” admin ë¹„ë°€ë²ˆí˜¸ë¥¼ ê°•í•˜ê²Œ ë°”ê¾¸ëŠ” ê²ƒì´ í•„ìˆ˜!
    """
    con = _conn()
    cur = con.cursor()

    # [í…Œì´ë¸”] ì‚¬ìš©ì ê³„ì • ì •ë³´
    cur.execute("""
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,  -- ë‚´ë¶€ ì‹ë³„ì(PK)
        username TEXT UNIQUE NOT NULL,         -- ë¡œê·¸ì¸ ì•„ì´ë””(ì˜ë¬¸/ìˆ«ì/ì–¸ë”ìŠ¤ì½”ì–´ 3~20)
        email    TEXT UNIQUE,                  -- ì´ë©”ì¼(ì„ íƒ)
        password_hash TEXT NOT NULL,           -- bcrypt í•´ì‹œ ì €ì¥(í‰ë¬¸ ì €ì¥ ê¸ˆì§€!)
        role TEXT DEFAULT 'user',              -- ê¶Œí•œ: 'user' | 'admin'
        created_at TEXT,                       -- ê°€ì… ì‹œê°(UTC ISO8601)
        last_login TEXT                        -- ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°(UTC ISO8601)
    )
    """)

    # [í…Œì´ë¸”] ì‚¬ìš©ìì˜ ì˜í™” í‰ì (ê°œì¸í™” ì¶”ì²œìš© ë°ì´í„°)
    cur.execute("""
    CREATE TABLE IF NOT EXISTS user_ratings (
        user_id INTEGER NOT NULL,              -- í‰ì ì„ ë‚¨ê¸´ ì‚¬ìš©ì
        movie_id INTEGER NOT NULL,             -- ì˜í™” ID(ë°ì´í„°ì…‹ ê¸°ì¤€)
        rating REAL NOT NULL,                  -- 0.5~5.0 ì‚¬ì´ ì ìˆ˜ ê¶Œì¥
        rated_at TEXT,                         -- í‰ê°€ ì‹œê°(UTC ISO8601)
        PRIMARY KEY (user_id, movie_id)        -- ë™ì¼ ì˜í™” ì¤‘ë³µ í‰ê°€ ë°©ì§€(ë³µí•© PK)
    )
    """)

    # [í…Œì´ë¸”] ì‚¬ìš©ìì˜ ì¦ê²¨ì°¾ê¸°(ë¶ë§ˆí¬)
    cur.execute("""
    CREATE TABLE IF NOT EXISTS user_favorites (
        user_id INTEGER NOT NULL,
        movie_id INTEGER NOT NULL,
        created_at TEXT,
        PRIMARY KEY (user_id, movie_id)        -- ë™ì¼ ì˜í™” ì¤‘ë³µ ë¶ë§ˆí¬ ë°©ì§€
    )
    """)

    con.commit()

    # [ì‹œë“œ ë°ì´í„°] ê¸°ë³¸ admin ê³„ì •ì´ ì—†ìœ¼ë©´ ìƒì„±
    cur.execute("SELECT 1 FROM users WHERE username = ?", ("admin",))
    if not cur.fetchone():
        cur.execute(
            "INSERT INTO users (username, email, password_hash, role, created_at) VALUES (?,?,?,?,?)",
            (
                "admin",
                "admin@example.com",
                bcrypt.hash("admin123"),          # (ì£¼ì˜) ë°ëª¨ìš©. ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë°˜ë“œì‹œ ë³€ê²½!
                "admin",
                datetime.utcnow().isoformat() + "Z"
            )
        )
        con.commit()

    con.close()


# ---------------------------------------------------------------------
# 2) ì‚¬ìš©ì ê´€ë ¨ ì¿¼ë¦¬/ìœ í‹¸ (CRUD + ìœ íš¨ì„± ê²€ì‚¬)
# ---------------------------------------------------------------------
def user_by_username(username: str) -> Optional[Dict[str, Any]]:
    """
    [ì—­í• ] usernameìœ¼ë¡œ ì‚¬ìš©ì 1ëª…ì„ ì¡°íšŒ.
    - ë°˜í™˜: dict(ì¼ì¹˜ ì‹œ) / None(ì—†ìœ¼ë©´)
    """
    con = _conn()
    cur = con.cursor()
    cur.execute("""
        SELECT id, username, email, password_hash, role, created_at, last_login
        FROM users WHERE username=?
    """, (username,))
    row = cur.fetchone()
    con.close()

    if row:
        keys = ["id", "username", "email", "password_hash", "role", "created_at", "last_login"]
        return dict(zip(keys, row))
    return None


def create_user(username: str, email: Optional[str], password: str) -> None:
    """
    [ì—­í• ] ì‹ ê·œ ì‚¬ìš©ì ìƒì„±.
    - ë¹„ë°€ë²ˆí˜¸ëŠ” bcrypt.hashë¡œ í•´ì‹œ ì €ì¥(í‰ë¬¸ ì ˆëŒ€ ê¸ˆì§€)
    - username/email UNIQUE ì œì•½ â†’ ì¤‘ë³µ ì‹œ sqlite3.IntegrityError ë°œìƒ
    """
    con = _conn()
    cur = con.cursor()
    cur.execute("""
        INSERT INTO users (username, email, password_hash, role, created_at)
        VALUES (?,?,?,?,?)
    """, (username, email, bcrypt.hash(password), "user", datetime.utcnow().isoformat() + "Z"))
    con.commit()
    con.close()


def update_last_login(uid: int) -> None:
    """
    [ì—­í• ] ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ì„ ê°±ì‹ (ê°ì‚¬/ë³´ì•ˆìš© ë¡œê·¸).
    """
    con = _conn()
    cur = con.cursor()
    cur.execute("UPDATE users SET last_login=? WHERE id=?", (datetime.utcnow().isoformat() + "Z", uid))
    con.commit()
    con.close()


def valid_username(u: str) -> bool:
    """
    [ì—­í• ] ì•„ì´ë”” í˜•ì‹ ê²€ì‚¬.
    - í—ˆìš©: ì˜ë¬¸/ìˆ«ì/ì–¸ë”ìŠ¤ì½”ì–´, ê¸¸ì´ 3~20
    """
    return bool(re.fullmatch(r"[a-zA-Z0-9_]{3,20}", u))


def strong_pw(p: str) -> bool:
    """
    [ì—­í• ] ë¹„ë°€ë²ˆí˜¸ ìµœì†Œ ê°•ë„ ê²€ì‚¬(ê°„ë‹¨ ë²„ì „).
    - 8ì ì´ìƒ
    - ì˜ë¬¸ 1ê°œ ì´ìƒ
    - ìˆ«ì 1ê°œ ì´ìƒ
    (í•„ìš” ì‹œ íŠ¹ìˆ˜ë¬¸ì/ëŒ€ë¬¸ì ì¡°ê±´ì„ ë” ì¶”ê°€í•´ ê°•í™” ê°€ëŠ¥)
    """
    return len(p) >= 8 and re.search(r"[A-Za-z]", p) and re.search(r"\d", p)


# ---------------------------------------------------------------------
# 3) (ì„ íƒ) í‰ì /ì¦ê²¨ì°¾ê¸° helper â€” ì¶”ì²œ ì‹œìŠ¤í…œê³¼ì˜ ì—°ê²° ì§€ì 
# ---------------------------------------------------------------------
def set_rating(user_id: int, movie_id: int, rating: float) -> None:
    """
    [ì—­í• ] ì‚¬ìš©ìì˜ ì˜í™” í‰ì ì„ ì €ì¥/ê°±ì‹ .
    - (user_id, movie_id) ë³µí•© PKë¡œ ì¤‘ë³µ ë¶ˆê°€
    - UPSERT: ì´ë¯¸ ìˆìœ¼ë©´ ì ìˆ˜/ì‹œê°„ë§Œ ì—…ë°ì´íŠ¸
    """
    con = _conn()
    cur = con.cursor()
    cur.execute("""
        INSERT INTO user_ratings (user_id, movie_id, rating, rated_at)
        VALUES (?,?,?,?)
        ON CONFLICT(user_id, movie_id) DO UPDATE SET
            rating=excluded.rating, rated_at=excluded.rated_at
    """, (user_id, movie_id, rating, datetime.utcnow().isoformat() + "Z"))
    con.commit()
    con.close()


def toggle_favorite(user_id: int, movie_id: int) -> bool:
    """
    [ì—­í• ] ì¦ê²¨ì°¾ê¸°(ë¶ë§ˆí¬) í† ê¸€.
    - ì´ë¯¸ ìˆìœ¼ë©´ ì‚­ì œí•˜ê³  False ë°˜í™˜
    - ì—†ìœ¼ë©´ ì¶”ê°€í•˜ê³  True ë°˜í™˜
    """
    con = _conn()
    cur = con.cursor()
    cur.execute("SELECT 1 FROM user_favorites WHERE user_id=? AND movie_id=?", (user_id, movie_id))
    exists = cur.fetchone() is not None

    if exists:
        cur.execute("DELETE FROM user_favorites WHERE user_id=? AND movie_id=?", (user_id, movie_id))
        con.commit()
        con.close()
        return False
    else:
        cur.execute("""
            INSERT INTO user_favorites (user_id, movie_id, created_at)
            VALUES (?,?,?)
        """, (user_id, movie_id, datetime.utcnow().isoformat() + "Z"))
        con.commit()
        con.close()
        return True


# ---------------------------------------------------------------------
# 4) Streamlit ì¸ì¦ ê²Œì´íŠ¸ (ë¡œê·¸ì¸/íšŒì›ê°€ì… UI + ì„¸ì…˜ ê´€ë¦¬)
# ---------------------------------------------------------------------
def show_auth_gate() -> bool:
    """
    [ì—­í• ] ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ì„ ë Œë”ë§í•˜ê³ ,
          ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ st.session_state['auth_user']ì— ìµœì†Œ ì •ë³´ë§Œ ì €ì¥.
    - ë°˜í™˜ True  : í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœ(ì¸ì¦ë¨)
    - ë°˜í™˜ False : ì•„ì§ ë¡œê·¸ì¸ ì „(ë¯¸ì¸ì¦)
    """
    # ì„¸ì…˜ì— ì¸ì¦ ì‚¬ìš©ì ê°ì²´ ë³´ê´€(ì—†ìœ¼ë©´ None)
    st.session_state.setdefault("auth_user", None)

    # [ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœ] ìƒë‹¨ í™˜ì˜ ë©”ì‹œì§€ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í‘œì‹œ
    if st.session_state["auth_user"]:
        u = st.session_state["auth_user"]
        colL, colR = st.columns([3, 1], vertical_alignment="center")
        with colL:
            st.success(f"ğŸ‘‹ {u['username']} ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤! (role: {u['role']})")
        with colR:
            if st.button("ë¡œê·¸ì•„ì›ƒ"):
                st.session_state["auth_user"] = None  # ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ì œê±°
                st.rerun()                            # í™”ë©´ ê°±ì‹ 
        return True

    # [ë¯¸ë¡œê·¸ì¸ ìƒíƒœ] â†’ ë¡œê·¸ì¸/íšŒì›ê°€ì… íƒ­ UI
    st.markdown("### ğŸ” ë¡œê·¸ì¸ / íšŒì›ê°€ì…")
    tab_login, tab_join = st.tabs(["ë¡œê·¸ì¸", "íšŒì›ê°€ì…"])

    # -- ë¡œê·¸ì¸ íƒ­
    with tab_login:
        login_user = st.text_input("ì‚¬ìš©ìëª…", key="login_user")
        login_pw   = st.text_input("ë¹„ë°€ë²ˆí˜¸", type="password", key="login_pw")

        if st.button("ë¡œê·¸ì¸"):
            user = user_by_username(login_user.strip())
            if not user:
                st.error("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.")
            elif not bcrypt.verify(login_pw, user["password_hash"]):
                # (ì¤‘ìš”) í‰ë¬¸ ë¹„êµ ê¸ˆì§€. ë°˜ë“œì‹œ bcrypt.verify() ì‚¬ìš©
                st.error("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
            else:
                update_last_login(user["id"])
                # ì„¸ì…˜ì—ëŠ” ê³µê°œ ê°€ëŠ¥í•œ ìµœì†Œ í•„ë“œë§Œ ì €ì¥(í•´ì‹œ ê°™ì€ ë¯¼ê°ì •ë³´ ë°°ì œ)
                st.session_state["auth_user"] = {
                    k: user[k] for k in ("id", "username", "email", "role", "created_at", "last_login")
                }
                st.success("ë¡œê·¸ì¸ ì„±ê³µ! ì°½ì´ ê°±ì‹ ë©ë‹ˆë‹¤â€¦")
                time.sleep(0.3)
                st.rerun()

    # -- íšŒì›ê°€ì… íƒ­
    with tab_join:
        j_user = st.text_input("ì‚¬ìš©ìëª…(ì˜ë¬¸/ìˆ«ì/ì–¸ë”ìŠ¤ì½”ì–´, 3~20ì)", key="join_user")
        j_email= st.text_input("ì´ë©”ì¼(ì„ íƒ)", key="join_email")
        j_pw   = st.text_input("ë¹„ë°€ë²ˆí˜¸(8ì ì´ìƒ, ì˜ë¬¸/ìˆ«ì í¬í•¨ ê¶Œì¥)", type="password", key="join_pw")
        j_pw2  = st.text_input("ë¹„ë°€ë²ˆí˜¸ í™•ì¸", type="password", key="join_pw2")

        if st.button("íšŒì›ê°€ì…"):
            u = j_user.strip()
            if not valid_username(u):
                st.warning("ì‚¬ìš©ìëª… í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
            elif j_pw != j_pw2:
                st.warning("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
            elif not strong_pw(j_pw):
                st.warning("ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤. (8ì ì´ìƒ, ì˜ë¬¸/ìˆ«ì í¬í•¨ ê¶Œì¥)")
            elif user_by_username(u):
                st.warning("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.")
            else:
                try:
                    create_user(u, j_email.strip() or None, j_pw)
                    st.success("íšŒì›ê°€ì… ì™„ë£Œ! ì´ì œ ë¡œê·¸ì¸í•˜ì„¸ìš”.")
                except sqlite3.IntegrityError:
                    st.error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì/ì´ë©”ì¼ì…ë‹ˆë‹¤.")
                except Exception as e:
                    st.error(f"íšŒì›ê°€ì… ì‹¤íŒ¨: {e}")

    return False  # ì—¬ê¸°ê¹Œì§€ ì˜¤ë©´ ì•„ì§ ì¸ì¦ë˜ì§€ ì•ŠìŒ


# ---------------------------------------------------------------------
# 5) ê°œì¸í™” ì¶”ì²œ ë²„íŠ¼ ì„¹ì…˜ (ì™¸ë¶€ì˜ ì¶”ì²œ í•¨ìˆ˜ ì£¼ì… ì‚¬ìš©)
# ---------------------------------------------------------------------
def render_personal_reco_section(recommend_for_user_func) -> None:
    """
    [ì—­í• ] 'âœ¨ ë‚˜ë¥¼ ìœ„í•œ ê°œì¸í™” ì¶”ì²œ' ë²„íŠ¼ê³¼ ì¹´ë“œ ê·¸ë¦¬ë“œ UI.
    - recommend_for_user_func(user_id:int, top_k:int) -> pandas.DataFrame
      * ìµœì†Œ ì»¬ëŸ¼: ['title', 'poster_url'] (ì—†ìœ¼ë©´ placeholderë¡œ ëŒ€ì²´)
    - ì„¸ì…˜ì˜ ë¡œê·¸ì¸ ì‚¬ìš©ì IDë¥¼ ë„˜ê²¨ ì™¸ë¶€ ì¶”ì²œ ëª¨ë“ˆê³¼ ì—°ê²°í•œë‹¤.
    """
    user = st.session_state.get("auth_user")

    if user and st.button("âœ¨ ë‚˜ë¥¼ ìœ„í•œ ê°œì¸í™” ì¶”ì²œ ë³´ê¸°"):
        # ì™¸ë¶€ ì¶”ì²œ í•¨ìˆ˜ í˜¸ì¶œ(í˜‘ì—…/ì½˜í…ì¸  ê¸°ë°˜/í•˜ì´ë¸Œë¦¬ë“œ ë“± ì›í•˜ëŠ” êµ¬í˜„ì²´)
        df = recommend_for_user_func(user["id"], top_k=20)

        if df is None or getattr(df, "empty", True):
            st.info("ê°œì¸í™” ë°ì´í„°ë¥¼ ë§Œë“¤ë ¤ë©´ ë¨¼ì € ëª‡ í¸ì— í‰ì ì„ ì£¼ì„¸ìš”! (4ì  ì´ìƒ ê¶Œì¥)")
            return

        st.markdown("### âœ¨ ê°œì¸í™” ì¶”ì²œ")
        cols = st.columns(5)
        placeholder = "https://via.placeholder.com/185x278?text=No+Image"
        for i, (_, row) in enumerate(df.iterrows()):
            with cols[i % 5]:
                st.image(row.get("poster_url") or placeholder, use_container_width=True)
                st.caption(str(row.get("title", "Untitled")))


# ---------------------------------------------------------------------
# 6) ë¼ì´íŠ¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
# ---------------------------------------------------------------------
def render_admin() -> None:
    """
    [ì—­í• ] ê´€ë¦¬ì ì „ìš© ë¯¸ë‹ˆ ëŒ€ì‹œë³´ë“œ.
    - ì ‘ê·¼ ì¡°ê±´: ë¡œê·¸ì¸ë˜ì–´ ìˆê³  role == 'admin'
    - ë³´ì—¬ì£¼ëŠ” ì§€í‘œ: ê°€ì…ì ìˆ˜ / í‰ê°€ ìˆ˜ / ì¦ê²¨ì°¾ê¸° ìˆ˜
    """
    user = st.session_state.get("auth_user")
    if not (user and user.get("role") == "admin"):
        st.info("ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥")
        return

    st.subheader("ğŸ‘‘ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ë¼ì´íŠ¸)")

    # ê°„ë‹¨í•œ ì§‘ê³„ ì¿¼ë¦¬
    con = _conn()
    cur = con.cursor()
    cur.execute("SELECT COUNT(*) FROM users"); users_n = cur.fetchone()[0]
    cur.execute("SELECT COUNT(*) FROM user_ratings"); ratings_n = cur.fetchone()[0]
    cur.execute("SELECT COUNT(*) FROM user_favorites"); fav_n = cur.fetchone()[0]
    con.close()

    # ì¹´ë“œí˜• ë©”íŠ¸ë¦­ UI
    c1, c2, c3 = st.columns(3)
    c1.metric("ê°€ì…ì ìˆ˜", users_n)
    c2.metric("í‰ê°€ ìˆ˜", ratings_n)
    c3.metric("ì¦ê²¨ì°¾ê¸° ìˆ˜", fav_n)


# ---------------------------------------------------------------------
# 7) ëª¨ë“ˆ ì´ˆê¸°í™”(ì•± ì‹œì‘ ì‹œ 1íšŒ)
# ---------------------------------------------------------------------
# [ì—­í• ] ì• í”Œë¦¬ì¼€ì´ì…˜ì´ import ë˜ëŠ” ì‹œì ì— DB ìŠ¤í‚¤ë§ˆë¥¼ ë³´ì¥í•œë‹¤.
init_db()

# (ì˜ˆì‹œ) Streamlit ë©”ì¸ì—ì„œì˜ ì‚¬ìš© ë°©ë²•:
# --------------------------------------
# authed = show_auth_gate()  # 1) ì¸ì¦ ê²Œì´íŠ¸ í˜¸ì¶œ
# if authed:
#     # 2) ì¶”ì²œ ì„¹ì…˜(ì™¸ë¶€ì˜ ì¶”ì²œ í•¨ìˆ˜ ì£¼ì…)
#     render_personal_reco_section(recommend_for_user)
#
#     # 3) ê´€ë¦¬ì ì˜ì—­(ê´€ë¦¬ìë§Œ)
#     with st.expander("ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì—´ê¸°"):
#         render_admin()
